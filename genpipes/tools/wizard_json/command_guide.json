{
    "_meta": {
        "entry_point": "start_command_guide",
        "version": 1.0,
        "description": "Guide to help construct the command to run GenPipes"
    },
    "nodes":[
        {
            "id": "start_command_guide",
            "type": "input",
            "variable": "raw_readset_filename",
            "prompt": "Enter the name of the readset file:", 
            "next": "store_readset_filename"
        },
        {
            "id": "store_readset_filename", 
            "type": "set_variable",
            "variable": "readset_filename",
            "value": "1_TODO_IN_PYTHON",
            "next": "slurm_job_scheduler_question"
        },
        {
            "id": "slurm_job_scheduler_question", 
            "type": "confirm",
            "question": "Do you want to use the SLURM job scheduler?",
            "options": [
                {
                    "label": "Yes",
                    "next": "slurm_j_command"
                },
                {
                    "label": "No",
                    "next": "general_job_scheduler_question"
                }
            ]
        },
        {
            "id": "slurm_j_command", 
            "type": "set_variable",
            "variable": "j_command",
            "value": "-j slurm",
            "next": "slurm_server_question"
        },
        {
            "id": "slurm_server_question",
            "type": "selection",
            "question": "Select the SLURM server you want to use:",
            "choices": [
                {"label": "Beluga", "node": "beluga_server_ini"},
                {"label": "Cedar", "node": "cedar_server_ini"},
                {"label": "Narval", "node": "narval_server_ini"}
            ]
        },
        {
            "id": "beluga_server_ini", 
            "type": "set_variable",
            "variable": "scheduler_server_name",
            "value": "beluga",
            "next": "store_server_for_custom_ini"
        },
        {
            "id": "cedar_server_ini", 
            "type": "set_variable",
            "variable": "scheduler_server_name",
            "value": "cedar",
            "next": "store_server_for_custom_ini"
        },
        {
            "id": "narval_server_ini", 
            "type": "set_variable",
            "variable": "scheduler_server_name",
            "value": "narval",
            "next": "store_server_for_custom_ini"
        },
        {
            "id": "general_job_scheduler_question",
            "type": "selection",
            "question": "Which job scheduler do you want to use?",
            "choices": [
                {"label": "Abacus", "node": "abacus_j_command"},
                {"label": "Batch", "node": "batch_j_command"}
            ]
        },
        {
            "id": "abacus_j_command",
            "type": "set_variable",
            "variable": "j_command",
            "value": "-j pbs",
            "next": "custom_ini_question"
        },
        {
            "id": "batch_j_command",
            "type": "set_variable",
            "variable": "j_command",
            "value": "-j batch",
            "next": "batch_server_ini"
        },
        {
            "id": "batch_server_ini",
            "type": "set_variable",
            "variable": "scheduler_server_name",
            "value": "batch",
            "next": "store_name_for_server_ini"
        },
        {
            "id": "store_name_for_server_ini",
            "type": "set_variable",
            "variable": "server_ini",
            "value": "GENPIPES_INIS/common_ini/{scheduler_server_name}.ini",
            "next": "custom_ini_question"
        },
        {
            "id": "custom_ini_question",
            "type": "switch",
            "variable": "pipeline_name",
            "cases": {
                "ampliconseq": {"node": "o_command_question"},
                "chipseq": {"node": "o_command_question"},
                "covseq": {"node": "o_command_question" },
                "dnaseq": {"node": "custom_ini_check_protocol"},
                "longread_dnaseq": {"node": "o_command_question"},
                "methylseq": {"node": "o_command_question"},
                "nanopore_covseq": {"node": "path_custom_ini_question"},
                "rnaseq": {"node": "o_command_question"},
                "rnaseq_denovo_assembly": {"node": "o_command_question"},
                "rnaseq_light": {"node": "o_command_question"}
            }
        },
        {
            "id": "custom_ini_check_protocol",
            "type": "switch",
            "variable": "protocol_name",
            "cases": {
                "germline_snv": {"node": "o_command_question"},
                "germline_sv": {"node": "path_custom_ini_question"},
                "germline_high_cov": {"node": "o_command_question"},
                "somatic_tumor_only": {"node": "o_command_question"},
                "somatic_fastpass": {"node": "path_custom_ini_question"},
                "somatic_ensemble": {"node": "path_custom_ini_question"},
                "somatic_sv": {"node": "path_custom_ini_question"}
            }
        },
        {
            "id": "path_custom_ini_question",
            "type": "input",
            "variable": "raw_path_custom_ini",
            "prompt": "Enter the path to your custom ini:",
            "next": "store_path_custom_ini"
        },
        {
            "id": "store_path_custom_ini",
            "type": "set_variable",
            "variable": "path_custom_ini",
            "value": "2_TODO_IN_PYTHON",
            "next": "o_command_question"
        },
        {
            "id": "o_command_question",
            "type": "confirm",
            "question":"Do you want to run the pipeline somewhere other than your current directory ?",
            "options": [
                {
                    "label": "Yes",
                    "next": "input_directory_name"
                },
                {
                    "label": "No",
                    "next": "pipeline_check_for_file_question"
                }
            ]
        },
        {
            "id": "input_directory_name",
            "type": "input",
            "variable": "raw_directory_name",
            "prompt": "Enter the name of the directory you want to run the pipeline in:", 
            "next": "store_directory_name"
        },
        {
            "id": "store_directory_name",
            "type": "set_variable",
            "variable": "o_command",
            "value": "-o {raw_directory_name}",
            "next": "pipeline_check_for_file_question"
        }
    ]
}